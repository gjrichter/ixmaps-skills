<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{TITLE}}</title>
    <script src="https://cdn.jsdelivr.net/gh/gjrichter/ixmaps-flat@master/ixmaps.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; }
        #map { width: 100%; height: 100vh; }
        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 999; color: #666; }
    </style>
</head>
<body>
    <div id="loading">Loading map...</div>
    <div id="map"></div>

    <script>
        // Point data configuration

        // Option 1: Inline data (embedded in HTML - works immediately)
        const pointData = {{POINT_DATA}};

        // Option 2: External hosted data (recommended for production)
        // Uncomment and replace with your GitHub CDN URL:
        // const dataConfig = {
        //     url: "https://cdn.jsdelivr.net/gh/<user>/ixmaps-data@main/by-date/2026-02/points.csv",
        //     type: "csv"
        // };
        // Then use: .data(dataConfig) instead of .data({ obj: pointData, type: "json" })
        //
        // See DATA_HOSTING_GUIDE.md for setup

        try {
            ixmaps.Map("map", {
                mapType: "{{MAPTYPE}}",
                mode: "info"
            })
            .options({
                objectscaling: "dynamic",
                normalSizeScale: "{{NORMAL_SIZE_SCALE}}",
                basemapopacity: {{BASEMAP_OPACITY}},
                flushChartDraw: {{FLUSH_CHART_DRAW}}
            })
            .view({
                center: { lat: {{CENTER_LAT}}, lng: {{CENTER_LNG}} },
                zoom: {{ZOOM}}
            })
            .legend("{{LEGEND_TITLE}}")
            .layer(
                ixmaps.layer("points")
                    .data({ obj: pointData, type: "json" })
                    .binding({
                        geo: "{{GEO_FIELD}}",
                        {{VALUE_BINDING}}
                        title: "{{TITLE_FIELD}}"
                    })
                    .type("{{VIZ_TYPE}}")
                    .style({
                        colorscheme: {{COLORSCHEME}},
                        {{SCALE_PROPERTY}}
                        {{GRID_WIDTH}}
                        opacity: {{OPACITY}},
                        showdata: "true"
                    })
                    .meta({
                        tooltip: "{{TOOLTIP_TEMPLATE}}"
                    })
                    .title("{{LAYER_TITLE}}")
                    .define()
            );

            setTimeout(() => document.getElementById('loading').style.display = 'none', 1000);

        } catch (error) {
            console.error('Map initialization failed:', error);
            document.getElementById('loading').innerHTML = '<div style="color: #d32f2f;">Error: ' + error.message + '</div>';
        }
    </script>
</body>
</html>
